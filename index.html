<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Lab 3 - Extra Map Features</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        #map {
            height: 600px;
            width: 100%;
        }
        body {
            margin: 0;
        }

        /* شكل صندوقات الكنترول */
        .leaflet-control-custom,
        .leaflet-control-clock,
        .leaflet-control-northarrow,
        .leaflet-control-coords {
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        .leaflet-control-northarrow {
            font-weight: bold;
            text-align: center;
        }

        .leaflet-control-custom button {
            background: #0078ff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
        }

        .leaflet-control-custom button:hover {
            background: #005fcc;
        }
    </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- jQuery for Ajax -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // 1) إنشاء الخريطة
    var map = L.map('map').setView([31.9, 35.2], 12);

    // 2) طبقتي الأساس: نهاري + ليلي (Night mode)
    var osmDay = L.tileLayer(
        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        }
    ).addTo(map);   // النهاري شغال افتراضياً

    var osmNight = L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
        {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap &copy; CartoDB'
        }
    );

    // متغيرات الطبقات
    var zonesLayer;
    var wasteContainersLayer;

    // Layer control (لبعد ما تنعمل الطبقات)
    var baseLayers = {
        "Day": osmDay,
        "Night": osmNight
    };
    var overlays = {};
    var layerControl = L.control.layers(baseLayers, overlays).addTo(map);

    // 3) Scale bar (مقياس رسم)
    L.control.scale({
        metric: true,
        imperial: false
    }).addTo(map);

    // 4) إشارة الشمال (North arrow)
    var northControl = L.control({position: 'topright'});
    northControl.onAdd = function(map) {
        var div = L.DomUtil.create('div', 'leaflet-control-northarrow');
        div.innerHTML = 'N<br>&uarr;'; // سهم لأعلى
        return div;
    };
    northControl.addTo(map);

    // 5) ساعة حية (Clock)
    var clockControl = L.control({position: 'bottomleft'});
    clockControl.onAdd = function(map) {
        var div = L.DomUtil.create('div', 'leaflet-control-clock');
        function updateClock() {
            var now = new Date();
            div.innerHTML = now.toLocaleTimeString();
        }
        updateClock();
        setInterval(updateClock, 1000);
        return div;
    };
    clockControl.addTo(map);

    // 6) إحداثيات مؤشر الفأرة (الميزة الإضافية الأولى)
    var coordsControl = L.control({position: 'bottomright'});
    coordsControl.onAdd = function(map) {
        var div = L.DomUtil.create('div', 'leaflet-control-coords');
        div.innerHTML = 'Move mouse on map';
        map.on('mousemove', function(e) {
            div.innerHTML = 'Lat: ' + e.latlng.lat.toFixed(4) +
                            ' , Lng: ' + e.latlng.lng.toFixed(4);
        });
        return div;
    };
    coordsControl.addTo(map);

    // 7) زر "Zoom to Ramallah" (الميزة الإضافية الثانية)
    var zoomToLayerControl = L.control({position: 'topleft'});
    zoomToLayerControl.onAdd = function(map) {
        var div = L.DomUtil.create('div', 'leaflet-control-custom');
        var button = L.DomUtil.create('button', '', div);
        button.innerHTML = 'Zoom to Zones';
        L.DomEvent.on(button, 'click', function(e) {
            L.DomEvent.stopPropagation(e);
            if (zonesLayer) {
                map.fitBounds(zonesLayer.getBounds());
            } else {
                alert("Zones layer not loaded yet.");
            }
        });
        return div;
    };
    zoomToLayerControl.addTo(map);

    // =====================
    // تحميل طبقة المناطق RamallahZones.json
    // =====================

    $.getJSON("RamallahZones.json", function (RZ) {
        zonesLayer = L.geoJson(RZ, {
            style: function (feature) {
                return {
                    fillColor: "yellow",
                    fillOpacity: 0.3,
                    color: "yellow",
                    weight: 1.0,
                    opacity: 0.7
                };
            },
            onEachFeature: function (feature, layer) {
                // كليك على المنطقة: اسم + MAIL_CODE
                layer.on('click', function (e) {
                    alert(
                        "Zone: " + (feature.properties.NAME_ENGLI || feature.properties.NAME) +
                        "\nMAIL_CODE: " + (feature.properties.MAIL_CODE || "")
                    );
                });
            }
        }).addTo(map);

        // تقريب على كل المناطق
        map.fitBounds(zonesLayer.getBounds());

        // إضافة الطبقة للـ overlays
        layerControl.addOverlay(zonesLayer, "Zones");
    });

    // =====================
    // تحميل طبقة الحاويات wasteContainer.json
    // =====================

    $.getJSON("wasteContainer.json", function (WC) {
        wasteContainersLayer = L.geoJson(WC, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: "orange",
                    color: "orange",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
            }
        }).addTo(map);

        // إضافة الطبقة للـ overlays
        layerControl.addOverlay(wasteContainersLayer, "Waste Containers");
    });

</script>

</body>
</html>
